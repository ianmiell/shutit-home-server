# We assert here that we are running as root
SEND whoami
ASSERT_OUTPUT root

# We assert here the user imiell was set up by the OS installation process
SEND cut -d: -f1 /etc/passwd | grep imiell | wc -l
ASSERT_OUTPUT 1

# Install required packages
INSTALL docker.io
INSTALL openssh-server
INSTALL run-one
INSTALL apache2
INSTALL vim
INSTALL python-pip
INSTALL meld
INSTALL tmux
INSTALL docker-compose
INSTALL openjdk-8-jre
INSTALL alien
INSTALL brasero
INSTALL virtualbox
INSTALL vagrant

# Install ShutIt, naturally
RUN pip install shutit
# Add imiell to the docker user group
RUN usermod -G docker -a imiell 

# Pull my dev tools image from Dockerhub
RUN docker pull imiell/docker-dev-tools-image

# Set up local storage
RUN mkdir -p /media/storage_{1,2}

# Generate an ssh key
RUN ssh-keygen
# Note that the response to 'already exists' below prevents overwrite here.
EXPECT_MULTI ['file in which=','empty for no passphrase=','Enter same passphrase again=','already exists=n']

# Log me in as imiell
LOGIN imiell
# If it's not been done before, check out my dotfiles and set it up
IF_NOT FILE_EXISTS /home/imiell/.dotfiles
	RUN git clone --depth=1 https://github.com/ianmiell/dotfiles ~imiell/.dotfiles
	RUN cd .dotfiles
	RUN ./script/bootstrap
ENDIF
LOGOUT


